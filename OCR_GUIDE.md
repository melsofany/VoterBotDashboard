# 📘 دليل استخدام نظام OCR للبطاقة المصرية

## 🎯 نظرة عامة
تم تحسين نظام OCR لاستخراج البيانات من البطاقة المصرية باستخدام **ذكاء اصطناعي مجاني** بدعم كامل للغة العربية والأرقام الهندية العربية.

---

## ✨ المميزات

### 1. **معالجة الصور المتقدمة**
- معالجة الصورة بـ 3 طرق مختلفة للحصول على أفضل نتيجة
- تحسين السطوع والتباين تلقائياً
- إزالة التشويش والضوضاء
- زيادة الحدة لتحسين قراءة النص

### 2. **نماذج ذكاء اصطناعي مجانية**
النظام يستخدم مجموعة من النماذج المجانية بالترتيب:

#### أ. **Hugging Face Models** (مجانية)
1. `facebook/nougat-base` - ممتاز للمستندات العربية
2. `microsoft/trocr-base-printed` - جيد للنصوص المطبوعة
3. `microsoft/trocr-large-printed` - دقة أعلى لكن أبطأ

#### ب. **Tesseract.js** (مجاني 100%)
- إذا فشلت جميع نماذج Hugging Face
- يدعم العربية والإنجليزية معاً
- يعمل بدون إنترنت

### 3. **البيانات المستخرجة**
- ✅ **الاسم الكامل** (بالعربية)
- ✅ **الرقم القومي** (14 رقم مع التحقق الذكي)
- ✅ **العنوان** (الشارع والمحافظة)
- ✅ **تحويل الأرقام** من الهندية (٠-٩) إلى اللاتينية (0-9)

---

## 🚀 كيفية الاستخدام

### 1. **إعداد Hugging Face (اختياري - لكن موصى به)**

للحصول على أفضل نتائج، احصل على API token مجاني من Hugging Face:

1. سجل حساب في [Hugging Face](https://huggingface.co/join)
2. اذهب إلى [Settings > Access Tokens](https://huggingface.co/settings/tokens)
3. أنشئ token جديد
4. أضفه إلى Replit Secrets:
   ```
   HUGGINGFACE_TOKEN=hf_xxxxxxxxxxxxxxxxxx
   ```

**ملاحظة:** بدون Token، سيستخدم النظام Tesseract فقط (ما زال مجانياً ويعمل جيداً!)

### 2. **استخدام البوت في Telegram**

```
1. ابدأ المحادثة: /start
2. أرسل صورة البطاقة
3. انتظر معالجة الصورة (5-15 ثانية)
4. سيتم استخراج البيانات تلقائياً!
```

---

## 💡 نصائح للحصول على أفضل نتائج

### 📸 **جودة الصورة**
- ✅ استخدم إضاءة جيدة (ضوء طبيعي أفضل)
- ✅ تجنب الظلال على البطاقة
- ✅ التقط الصورة من الأعلى مباشرة (90 درجة)
- ✅ تأكد من وضوح النص
- ❌ تجنب الانعكاسات والبريق
- ❌ لا تستخدم فلاش قريب جداً

### 📱 **إعدادات الكاميرا**
- دقة عالية (على الأقل 1080p)
- تركيز تلقائي على النص
- ثبات اليد أو استخدام حامل

### 🎨 **البطاقة نفسها**
- نظف البطاقة من الأوساخ
- تأكد من عدم وجود خدوش على النص
- إذا كانت البطاقة قديمة وباهتة، حاول زيادة التباين

---

## 🔧 التحسينات التقنية

### كيف يعمل النظام؟

```
1. استقبال الصورة
   ↓
2. معالجة أولية (تصغير، ضغط)
   ↓
3. إنشاء 3 نسخ مختلفة من الصورة
   ↓
4. محاولة Hugging Face (3 نماذج)
   ↓ (إذا فشل)
5. استخدام Tesseract على النسخ الثلاث
   ↓
6. اختيار النتيجة الأفضل (أعلى دقة)
   ↓
7. استخراج البيانات:
   - تحويل الأرقام (٠-٩ → 0-9)
   - البحث عن الرقم القومي (14 رقم)
   - استخراج الاسم (2-7 كلمات عربية)
   - البحث عن المحافظة والعنوان
   ↓
8. إرجاع البيانات المستخرجة
```

### المحافظات المدعومة
النظام يتعرف على جميع المحافظات المصرية:
```
القاهرة، الجيزة، الإسكندرية، الدقهلية، البحيرة، الفيوم، 
الغربية، الإسماعيلية، المنوفية، المنيا، القليوبية، الوادي الجديد،
الشرقية، السويس، أسوان، أسيوط، بني سويف، بورسعيد،
دمياط، الأقصر، قنا، كفر الشيخ، مطروح، 
شمال سيناء، جنوب سيناء، البحر الأحمر، سوهاج
```

---

## 🐛 حل المشاكل

### المشكلة: لا يتم استخراج الرقم القومي
**الحلول:**
1. تأكد من وضوح الأرقام في الصورة
2. جرب التقاط الصورة بإضاءة أفضل
3. تأكد من أن الرقم ظاهر بالكامل (14 رقم)
4. تجنب الظلال على منطقة الرقم

### المشكلة: الاسم غير صحيح
**الحلول:**
1. تأكد من وضوح منطقة الاسم
2. نظف البطاقة إذا كان الحبر باهتاً
3. تجنب الانعكاسات على منطقة الاسم
4. جرب زاوية مختلفة للتصوير

### المشكلة: العنوان غير مستخرج
**الحلول:**
1. تأكد من وجود اسم المحافظة في العنوان
2. تأكد من وضوح منطقة العنوان
3. قد تكون البطاقة قديمة ولا تحتوي على عنوان

---

## 📊 معدل النجاح

بناءً على الاختبارات:

| نوع البيانات | معدل النجاح | ملاحظات |
|--------------|-------------|---------|
| الرقم القومي | 85-95% | مع صورة جيدة |
| الاسم الكامل | 75-90% | يعتمد على وضوح الخط |
| العنوان | 60-80% | بعض البطاقات لا تحتوي عليه |
| الدقة الإجمالية | 80-92% | مع Hugging Face Token |
| الدقة بدون Token | 70-85% | باستخدام Tesseract فقط |

---

## 🔐 الأمان والخصوصية

- ✅ جميع الصور تُخزن في Google Drive الخاص بك (خاص وآمن)
- ✅ لا يتم مشاركة الصور مع أطراف ثالثة
- ✅ API tokens مخزنة بشكل آمن في Replit Secrets
- ✅ البيانات المستخرجة تُحفظ في Google Sheets الخاص بك فقط

---

## 🆓 التكلفة

**كل شيء مجاني 100%!**

| الخدمة | الحد المجاني | ملاحظات |
|--------|-------------|---------|
| Tesseract.js | غير محدود | يعمل محلياً |
| Hugging Face API | 30,000 طلب/شهر | كافٍ لمعظم الاستخدامات |
| Google Sheets | غير محدود | حد 10 مليون خلية |
| Google Drive | 15 GB مجاناً | يمكن زيادتها بالاشتراك |

---

## 📚 موارد إضافية

### نماذج OCR العربية الأخرى (للمطورين)

إذا أردت استخدام نماذج أكثر تطوراً:

1. **Qari-OCR v0.2** (الأفضل للعربية)
   - دقة عالية جداً (WER 0.160, CER 0.061)
   - يدعم التشكيل الكامل
   - يحتاج GPU قوي
   - [Hugging Face Model](https://huggingface.co/NAMAA-Space/Qari-OCR-0.2.2.1-VL-2B-Instruct)

2. **arabic-small-nougat**
   - خفيف وسريع
   - جيد للمستندات الطويلة
   - [Hugging Face Model](https://huggingface.co/MohamedRashad/arabic-small-nougat)

**ملاحظة:** هذه النماذج تحتاج إلى تشغيلها محلياً على جهاز قوي ولا تعمل في Replit المجاني.

---

## 🤝 المساهمة والدعم

إذا واجهت مشاكل أو لديك اقتراحات:

1. جرب النصائح في قسم "حل المشاكل"
2. تأكد من جودة الصورة أولاً
3. تحقق من السجلات (Logs) لمعرفة الخطأ الدقيق

---

## 📝 ملاحظات مهمة

1. **الصبر:** معالجة OCR قد تستغرق 5-15 ثانية
2. **الجودة مهمة:** صورة واضحة = نتائج أفضل بكثير
3. **التجربة:** إذا لم تنجح أول مرة، جرب صورة أوضح
4. **التحديثات:** النظام يتحسن باستمرار

---

تم التحديث في: أكتوبر 2025
الإصدار: 2.0 (محسّن مع معالجة متعددة ونماذج AI مجانية)
